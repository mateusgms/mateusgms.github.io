<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en"><generator uri="https://jekyllrb.com/" version="4.3.3">Jekyll</generator><link href="https://mateusgms.github.io/feed.xml" rel="self" type="application/atom+xml"/><link href="https://mateusgms.github.io/" rel="alternate" type="text/html" hreflang="en"/><updated>2024-07-25T18:27:11+00:00</updated><id>https://mateusgms.github.io/feed.xml</id><title type="html">blank</title><subtitle>I&apos;m a software engineer, with a focus on web development. I&apos;m passionate about technology, and I love to learn new things. I&apos;m currently using Java, Angular, Golang, Spring Boot, Spring Batch, Kubernetes, Docker, and more. </subtitle><entry><title type="html">Available Applications with Golang</title><link href="https://mateusgms.github.io/blog/2024/designing-available-apps/" rel="alternate" type="text/html" title="Available Applications with Golang"/><published>2024-07-24T21:55:00+00:00</published><updated>2024-07-24T21:55:00+00:00</updated><id>https://mateusgms.github.io/blog/2024/designing-available-apps</id><content type="html" xml:base="https://mateusgms.github.io/blog/2024/designing-available-apps/"><![CDATA[<h1 id="designing-available-applications-with-golang">Designing Available Applications with Golang</h1> <p>When working within a context where you cannot or do not want to change your infrastructure on distributed systems, an important question arises: How can I make my application more available?</p> <p>Available applications should only experience a maximum of 5% errors. If your error rate is higher than this, you have a problem, or worse, you might not even know you have a problem. But don’t worry, we’re talking about untreated errors or issues that arise because you haven’t managed your responses or status codes properly. Here, we’ll use Golang and Resty to help solve many of these issues.</p> <h2 id="lets-move-on">Let’s Move On!</h2> <p>Imagine you have an application that needs to call another microservice to retrieve product details, using only the product ID:</p> <h3 id="initial-code-example">Initial Code Example</h3> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
    <span class="s">"fmt"</span>
    <span class="s">"github.com/go-resty/resty/v2"</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">client</span> <span class="o">:=</span> <span class="n">resty</span><span class="o">.</span><span class="n">New</span><span class="p">()</span>

    <span class="c">// Example array of product IDs</span>
    <span class="n">ids</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">"123"</span><span class="p">,</span> <span class="s">"456"</span><span class="p">,</span> <span class="s">"789"</span><span class="p">}</span>

    <span class="c">// Make the request</span>
    <span class="n">resp</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">client</span><span class="o">.</span><span class="n">R</span><span class="p">()</span><span class="o">.</span>
        <span class="n">SetBody</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span><span class="o">.</span>
        <span class="n">SetResult</span><span class="p">(</span><span class="o">&amp;</span><span class="p">[]</span><span class="n">Product</span><span class="p">{})</span><span class="o">.</span>
        <span class="n">Post</span><span class="p">(</span><span class="s">"https://example.com/api/products"</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"Error: %v</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>

    <span class="n">products</span> <span class="o">:=</span> <span class="n">resp</span><span class="o">.</span><span class="n">Result</span><span class="p">()</span><span class="o">.</span><span class="p">(</span><span class="o">*</span><span class="p">[]</span><span class="n">Product</span><span class="p">)</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"Products: %v</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="o">*</span><span class="n">products</span><span class="p">)</span>
<span class="p">}</span>

<span class="c">// Product represents a product with details</span>
<span class="k">type</span> <span class="n">Product</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="n">ID</span>    <span class="kt">string</span> <span class="s">`json:"id"`</span>
    <span class="n">Name</span>  <span class="kt">string</span> <span class="s">`json:"name"`</span>
    <span class="n">Price</span> <span class="kt">float64</span> <span class="s">`json:"price"`</span>
<span class="p">}</span>
</code></pre></div></div> <p>If this request fails 50% of the time, what should you do? Oftentimes, we’ll call someone to inform them about the issue and work on a solution. But if you don’t have that option, you need to solve the problem yourself. Here are some approaches that can help:</p> <h3 id="retry">Retry</h3> <p>Retrying can help you get a successful response after initially encountering an error. In cases of transitory failures, like network issues or temporary overloads, you can increase the availability of your application by retrying the request.</p> <h4 id="be-careful">Be Careful:</h4> <p>When implementing retries, consider the following points:</p> <ol> <li>Retrying can improve availability but might also strain the client application.</li> <li>Ensure the third-party application has a rate limit setup to handle retries.</li> </ol> <h4 id="retry-implementation-with-resty">Retry Implementation with Resty</h4> <p>Here’s how you can implement the retry approach using Resty’s built-in mechanism:</p> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
    <span class="s">"errors"</span>
    <span class="s">"fmt"</span>
    <span class="s">"github.com/go-resty/resty/v2"</span>
    <span class="s">"time"</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">client</span> <span class="o">:=</span> <span class="n">resty</span><span class="o">.</span><span class="n">New</span><span class="p">()</span>

    <span class="c">// Configure retries</span>
    <span class="n">client</span><span class="o">.</span>
        <span class="n">SetRetryCount</span><span class="p">(</span><span class="m">3</span><span class="p">)</span><span class="o">.</span>
        <span class="n">SetRetryWaitTime</span><span class="p">(</span><span class="m">5</span> <span class="o">*</span> <span class="n">time</span><span class="o">.</span><span class="n">Second</span><span class="p">)</span><span class="o">.</span>
        <span class="n">SetRetryMaxWaitTime</span><span class="p">(</span><span class="m">20</span> <span class="o">*</span> <span class="n">time</span><span class="o">.</span><span class="n">Second</span><span class="p">)</span><span class="o">.</span>
        <span class="n">SetRetryAfter</span><span class="p">(</span><span class="k">func</span><span class="p">(</span><span class="n">client</span> <span class="o">*</span><span class="n">resty</span><span class="o">.</span><span class="n">Client</span><span class="p">,</span> <span class="n">resp</span> <span class="o">*</span><span class="n">resty</span><span class="o">.</span><span class="n">Response</span><span class="p">)</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Duration</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">StatusCode</span><span class="p">()</span> <span class="o">==</span> <span class="m">429</span> <span class="p">{</span> <span class="c">// Assuming 429 is the status code for quota exceeded</span>
                <span class="k">return</span> <span class="m">0</span><span class="p">,</span> <span class="n">errors</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="s">"quota exceeded"</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="m">0</span><span class="p">,</span> <span class="no">nil</span>
        <span class="p">})</span>

    <span class="c">// Example array of product IDs</span>
    <span class="n">ids</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">"123"</span><span class="p">,</span> <span class="s">"456"</span><span class="p">,</span> <span class="s">"789"</span><span class="p">}</span>

    <span class="c">// Make the request</span>
    <span class="n">resp</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">client</span><span class="o">.</span><span class="n">R</span><span class="p">()</span><span class="o">.</span>
        <span class="n">SetBody</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span><span class="o">.</span>
        <span class="n">SetResult</span><span class="p">(</span><span class="o">&amp;</span><span class="p">[]</span><span class="n">Product</span><span class="p">{})</span><span class="o">.</span>
        <span class="n">Post</span><span class="p">(</span><span class="s">"https://example.com/api/products"</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"Error: %v</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>

    <span class="n">products</span> <span class="o">:=</span> <span class="n">resp</span><span class="o">.</span><span class="n">Result</span><span class="p">()</span><span class="o">.</span><span class="p">(</span><span class="o">*</span><span class="p">[]</span><span class="n">Product</span><span class="p">)</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"Products: %v</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="o">*</span><span class="n">products</span><span class="p">)</span>
<span class="p">}</span>

<span class="c">// Product represents a product with details</span>
<span class="k">type</span> <span class="n">Product</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="n">ID</span>    <span class="kt">string</span> <span class="s">`json:"id"`</span>
    <span class="n">Name</span>  <span class="kt">string</span> <span class="s">`json:"name"`</span>
    <span class="n">Price</span> <span class="kt">float64</span> <span class="s">`json:"price"`</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="backoff">Backoff</h3> <p>Backoff strategies help mitigate issues caused by retries by specifying intervals between each retry attempt. You can use either an exponential or linear backoff. However, consider the following points:</p> <h4 id="be-careful-1">Be Careful:</h4> <ol> <li>Backoff may not be necessary if the client application guarantees delivery.</li> <li>For real-time applications, the delay introduced by backoff might be unacceptable.</li> <li>Scheduled workloads where the timing of the response is predictable.</li> <li>Unique contexts where repeated requests may cause unwanted side effects.</li> <li>Stress tests or workload simulations.</li> </ol> <p>Resty uses exponential backoff with jitter by default, which helps in preventing synchronized retries across multiple clients.</p> <h2 id="conclusion">Conclusion</h2> <p>These approaches can significantly improve the availability of your application. However, always adapt these methods to your specific context. Test, analyze, and validate to ensure the problem of availability is caused by third parties and understand how these changes will impact them. Thorough testing and evaluation can powerfully enhance your application’s robustness.</p>]]></content><author><name></name></author><category term="Golang"/><category term="golang"/><category term="code"/><category term="availability"/><category term="resty"/><summary type="html"><![CDATA[Designing Available Applications with Golang]]></summary></entry></feed>